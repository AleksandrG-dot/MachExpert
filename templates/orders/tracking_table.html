{% extends "base.html" %}
{% load custom_tags %}  {# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–µ–≥–∏ #}

{% block title %}–ì–ª–∞–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è{% endblock %}
{% block extra_css %}
<style>
    {# –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ #}
    .status-completed { background-color: #00FF00 !important; }
    .status-annulled { background-color: #FFFF00 !important; }

    .status-waiting_billet { background-color: #FFFF00 !important; }
    .status-at_work { background-color: #00FF00 !important; }

    .status-start { background-color: #e3f2fd !important; }

    {# –°—Ç–∏–ª–∏–ª–∏ –¥–ª—è  –†–¢–ö+–£–ü #}
    {# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫: class="pps-{{ item.pps_cp }} #}
    {# –ü–æ–∫–∞ –æ—Ç–∫–ª—é—á–∏–ª, –±–æ–ª—å—à–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤–æ–∫—Ä—É–≥ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ <td>). #}
    .pps-not_need { background-color: #f5f5f5 !important; }
    .pps-check { background-color: #fff3e0 !important; }
    .pps-make { background-color: #e3f2fd !important; }
    .pps-done { background-color: #e8f5e8 !important; }

    {# –°—Ç–∏–ª–∏ –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö —è—á–µ–µ–∫ #}
    .editable-cell:hover {
        background-color: #f0f0f0;
        cursor: pointer;
        text-decoration: underline;
    }
</style>
{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-2">
    <h2>üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ</h2>
    {% if user|has_group:'process_engineer' or user|has_group:'directors' %}
        <a href="#" class="btn btn-success">+ –î–æ–±–∞–≤–∏—Ç—å –≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ</a>
    {% endif %}
</div>
<div class="card">
    <div class="card-body">
        {% if tracking_data %}
            <div class="table-responsive">
                <table class="table table-bordered table-hover" style="text-align: center; vertical-align: middle;">
                    <thead class="table-info" style="text-align: center; vertical-align: middle;">
                        <tr>
                            <th rowspan="2">‚Ññ<br>–°–ó</th>
                            <th rowspan="2">–í–Ω—É—Ç—Ä.<br>–Ω–æ–º–µ—Ä</th>
                            <th rowspan="2">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏ –Ω–æ–º–µ—Ä –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã</th>
                            <th rowspan="2" style="writing-mode: vertical-lr; transform: rotate(180deg);">–ö–æ–ª-–≤–æ</th>
                            <th rowspan="2">–î–∞—Ç–∞ –æ—Ç–≥—Ä—É–∑–∫–∏</th>
                            <th colspan="3">–ö–¢–û</th>
                            <th colspan="4">–ü–î–û</th>
                            <th colspan="1">–°–ª. —Å–Ω–∞–±–∂–µ–Ω–∏—è</th>
                        </tr>
                        <tr>
                            <th>–î–∞—Ç–∞ <br> –∑–∞–Ω–µ—Å–µ–Ω–∏—è <br> –≤ 1–°</th>
                            <th>–î–∞—Ç–∞ <br> –ø–µ—Ä–µ–¥–∞—á–∏ <br> –°–ó –≤ –ü–î–û</th>
                            <th>–†–¢–ö+–£–ü</th>
                            <th>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞<br>–≤ 1–°</th>
                            <th>–î–∞—Ç–∞<br>–ø–µ—Ä–µ–¥–∞—á–∏ –°–ó<br>–≤ —Å–ª—É–∂–±—É<br>—Å–Ω–∞–±–∂–µ–Ω–∏—è</th>
                            <th>–î–∞—Ç–∞<br>–ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è<br>–Ω–∞ —Å–∫–ª–∞–¥<br>–∑–∞–≥–æ—Ç./–º–µ—Ç.</th>
                            <th>–°—Ç–∞—Ç—É—Å<br>–∑–∞–∫–∞–∑–∞</th>
                            <th>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç.<br>—Å—Ä–æ–∫<br>–ø–æ—Å—Ç–∞–≤–∫–∏<br>–∑–∞–≥–æ—Ç./–º–µ—Ç.</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in tracking_data %}
                        <tr>
                            {# ‚Ññ –°–ó #}
                            <td class="{% if user|has_group:'process_engineer' or user|has_group:'directors' %}editable-cell{% endif %}"
                                {% if user|has_group:'process_engineer' or user|has_group:'directors' %}
                                onclick="location.href='{% url 'edit_field' pk=item.pk field_name='order' %}'"
                                {% endif %}>
                                {{ item.order.number_bn }}
                            </td>

                            {# –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ #}
                            <td class="{% if user|has_group:'process_engineer' or user|has_group:'directors' %}editable-cell{% endif %}"
                                {% if user|has_group:'process_engineer' or user|has_group:'directors' %}
                                onclick="location.href='{% url 'edit_field' pk=item.pk field_name='internal_number' %}'"
                                {% endif %}>
                                {{ item.internal_number|default:"-" }}
                            </td>

                            {# –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ + —Ü–≤–µ—Ç–æ–≤–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ #}
                            <td class="{% if user|has_group:'process_engineer' or user|has_group:'directors' %}editable-cell{% endif %}
                                      {% if item.status_product == 'completed' %}status-completed
                                      {% elif item.status_product == 'annulled' %}status-annulled
                                      {% endif %}"
                                {% if user|has_group:'process_engineer' or user|has_group:'directors' %}
                                onclick="location.href='{% url 'edit_field' pk=item.pk field_name='product' %}'"
                                {% endif %}>
                                {{ item.product }}
                            </td>

                            {# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ #}
                            <td class="{% if user|has_group:'process_engineer' or user|has_group:'directors' %}editable-cell{% endif %}"
                                {% if user|has_group:'process_engineer' or user|has_group:'directors' %}
                                onclick="location.href='{% url 'edit_field' pk=item.pk field_name='quantity' %}'"
                                {% endif %}>
                                {{ item.quantity }}
                            </td>

                            {# –î–∞—Ç–∞ –æ—Ç–≥—Ä—É–∑–∫–∏ - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ #}
                            <td class="{% if user|has_group:'process_engineer' or user|has_group:'directors' %}editable-cell{% endif %}"
                                {% if user|has_group:'process_engineer' or user|has_group:'directors' %}
                                onclick="location.href='{% url 'edit_field' pk=item.pk field_name='date_shipment' %}'"
                                {% endif %}>
                                {{ item.date_shipment|date:"d.m.Y"|default:"-" }}
                            </td>

                            {# –î–∞—Ç–∞ –∑–∞–Ω–µ—Å–µ–Ω–∏—è –≤ 1–° #}
                            <td class="{% if user|has_group:'process_engineer' or user|has_group:'directors' %}editable-cell{% endif %}"
                                {% if user|has_group:'process_engineer' or user|has_group:'directors' %}
                                onclick="location.href='{% url 'edit_field' pk=item.pk field_name='date_entry_1c' %}'"
                                {% endif %}>
                            {{ item.date_entry_1c|date:"d.m.Y"|default:"-" }}
                            </td>

                            {# –î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –°–ó –≤ –ü–î–û#}
                            <td class="{% if user|has_group:'process_engineer' or user|has_group:'directors' %}editable-cell{% endif %}"
                                {% if user|has_group:'process_engineer' or user|has_group:'directors' %}
                                onclick="location.href='{% url 'edit_field' pk=item.pk field_name='date_transfer_to_pdd' %}'"
                                {% endif %}>
                            {{ item.date_transfer_to_pdd|date:"d.m.Y"|default:"-" }}
                            </td>

                            {# –ö–¢–û - –†–¢–ö+–£–ü #}
                            <td class="{% if user|has_group:'process_engineer' or user|has_group:'directors' %}editable-cell{% endif %}"
                                {% if user|has_group:'process_engineer' or user|has_group:'directors' %}
                                onclick="location.href='{% url 'edit_field' pk=item.pk field_name='pps_cp' %}'"
                                {% endif %}>

                                <span class="badge
                                    {% if item.pps_cp == 'not_need' %}display: none
                                    {% elif item.pps_cp == 'check' %}bg-warning
                                    {% elif item.pps_cp == 'make' %}bg-info
                                    {% elif item.pps_cp == 'done' %}bg-success
                                    {% else %}bg-danger{% endif %}">
                                    {{ item.get_pps_cp_display }}
                                </span>
                            </td>

                            {# –ü–î–û - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ü–î–û –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ #}
                            {% if user|has_group:'plan_disp_department' or user|has_group:'directors' %}

                                {# –ü–î–û: –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –≤ 1–° #}
                                <td class="editable-cell"
                                    onclick="location.href='{% url 'edit_field' pk=item.pk field_name='order_number_1c' %}'">
                                    {{ item.order_number_1c|default:"-" }}
                                </td>

                                {# –ü–î–û: –î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –°–ó –≤ –°–ª—É–∂–±—É —Å–Ω–∞–±–∂–µ–Ω–∏—è #}
                                <td class="editable-cell"
                                    onclick="location.href='{% url 'edit_field' pk=item.pk field_name='date_transfer_to_ss' %}'">
                                    {{ item.date_transfer_to_ss|date:"d.m.Y"|default:"-" }}
                                </td>

                                {# –ü–î–û: –î–∞—Ç–∞ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –Ω–∞ —Å–∫–ª–∞–¥ –∑–∞–≥–æ—Ç., –º–µ—Ç–∞–ª–ª–∞ #}
                                <td class="editable-cell
                                   {% if item.status_product == 'completed' %}status-completed
                                   {% elif item.status_product == 'at_work' %}status-at_work
                                   {% elif item.status_product == 'waiting_billet' %}status-waiting_billet
                                   {% endif %}"
                                    onclick="location.href='{% url 'edit_field' pk=item.pk field_name='date_warehouse' %}'">
                                    {{ item.date_warehouse|date:"d.m.Y"|default:"-" }}
                                </td>
                            {% else %}
                                <td>{{ item.order_number_1c|default:"-" }}</td>
                                <td>{{ item.date_transfer_to_ss|date:"d.m.Y"|default:"-" }}</td>
                                <td class="
                                   {% if item.status_product == 'completed' %}status-completed
                                   {% elif item.status_product == 'at_work' %}status-at_work
                                   {% elif item.status_product == 'waiting_billet' %}status-waiting_billet
                                   {% endif %}">
                                    {{ item.date_warehouse|date:"d.m.Y"|default:"-" }}
                                </td>
                            {% endif %}

                            {# –°—Ç–∞—Ç—É—Å –ø—Ä–æ–¥—É–∫—Ü–∏–∏ #}
                            <td class="{% if user|has_group:'plan_disp_department' or user|has_group:'process_engineer' or user|has_group:'directors' %}
                            editable-cell
                            {% endif %}"
                                {% if user|has_group:'plan_disp_department' or user|has_group:'process_engineer' or user|has_group:'directors' %}
                                onclick="location.href='{% url 'edit_field' pk=item.pk field_name='status_product' %}'"
                                {% endif %}>
                                {{ item.get_status_product_display }}
                            </td>


                            {# –°–ª—É–∂–±–∞ —Å–Ω–∞–±–∂–µ–Ω–∏—è - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–Ω–∞–±–∂–µ–Ω–∏–µ –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ #}
                            {% if user|has_group:'supply_service' or user|has_group:'directors' %}

                                {# –°–ª—É–∂–±–∞ —Å–Ω–∞–±–∂–µ–Ω–∏—è - –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ä–æ–∫–∏ –ø–æ—Å—Ç–∞–≤–∫–∏ #}
                                <td class="editable-cell
                                   {% if item.status_product == 'completed' %}status-completed
                                   {% elif item.status_product == 'at_work' %}status-at_work
                                   {% elif item.status_product == 'waiting_billet' %}status-waiting_billet
                                   {% endif %}"
                                    onclick="location.href='{% url 'edit_field' pk=item.pk field_name='date_tentative_supply' %}'">
                                    {{ item.date_tentative_supply|date:"d.m.Y"|default:"-" }}
                                </td>
                            {% else %}
                                <td class="
                                   {% if item.status_product == 'completed' %}status-completed
                                   {% elif item.status_product == 'at_work' %}status-at_work
                                   {% elif item.status_product == 'waiting_billet' %}status-waiting_billet
                                   {% endif %}">
                                    {{ item.date_tentative_supply|date:"d.m.Y"|default:"-" }}
                                </td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="text-center py-4">
                <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}